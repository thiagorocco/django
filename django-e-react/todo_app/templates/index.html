<!-- todo_app/templates/index.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
</head>
<body>

<div id="root"></div>

<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

<script type="text/babel">
  class App extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        tasks: [],
        newTask: '',
      };
    }

    componentDidMount() {
      this.fetchTasks();
    }

    fetchTasks = async () => {
      const response = await fetch('http://localhost:8000/api/tasks/');
      const data = await response.json();
      this.setState({ tasks: data });
    };

    handleAddTask = async () => {
      await fetch('http://localhost:8000/api/tasks/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ title: this.state.newTask }),
      });

      this.setState({ newTask: '' });
      this.fetchTasks();
    };

    handleToggleTask = async (id, completed) => {
      await fetch(`http://localhost:8000/api/tasks/${id}/`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ completed: !completed }),
      });

      this.fetchTasks();
    };

    handleDeleteTask = async (id) => {
      await fetch(`http://localhost:8000/api/tasks/${id}/`, {
        method: 'DELETE',
      });

      this.fetchTasks();
    };

    render() {
      return (
        <div>
          <h1>Todo List</h1>
          <ul>
            {this.state.tasks.map((task) => (
              <li key={task.id}>
                <span
                  style={{ textDecoration: task.completed ? 'line-through' : 'none' }}
                  onClick={() => this.handleToggleTask(task.id, task.completed)}
                >
                  {task.title}
                </span>
                <button onClick={() => this.handleDeleteTask(task.id)}>Delete</button>
              </li>
            ))}
          </ul>
          <div>
            <input
              type="text"
              value={this.state.newTask}
              onChange={(e) => this.setState({ newTask: e.target.value })}
            />
            <button onClick={this.handleAddTask}>Add Task</button>
          </div>
        </div>
      );
    }
  }

  ReactDOM.render(<App />, document.getElementById('root'));
</script>

</body>
</html>
